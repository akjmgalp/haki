/*** HAKI: The Tool for runtime verification of JavaScript MVC Applications.
 * @authors Ibrahim Bilge, Aysu Betin Can
 * @version v1.0.0
 * @link https://github.com/thebilge/haki
 * @license GNU
 */
!function(a,b,c){"use strict";var d={};d.contains=function(a,c){for(var d=0;d<a.length;d++)if(b.equals(a[d],c))return!0;return!1},d.isUndefined=function(a){return"undefined"==typeof a},a.hakiLogFile=[];var e=[],f={};f.ignoreList={type:[],attribute:[]},f.HAKI_MODES={MANUEL:"MANUEL",AUTO_ONCE:"AUTO_ONCE",AUTO_ALWAYS:"AUTO_ALWAYS",ALL:"ALL"},f.types={OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean",FUNCTION:"function",ARRAY:"Array",DATE:"Date",FILE:"File",UNKNOWN:"Unknown"},f.setMode=function(a){f.mode=a,console.log("Haki mode changed to "+a)},f.ignoreType=function(a){f.ignoreList.type.push(a)},f.ignoreAttribute=function(a){f.ignoreList.attribute.push(a)},f.run=function(a){d.isUndefined(f.analyzer)||f.analyzer.analyze(a)},a.haki=f;var g=[{name:"ng-model",types:[f.types.STRING,f.types.NUMBER,f.types.OBJECT,f.types.ARRAY,f.types.DATE,f.types.FILE]},{name:"ng-bind",types:[f.types.STRING,f.types.NUMBER]},{name:"ng-bind-html",types:[f.types.STRING]},{name:"ng-bind-template",types:[f.types.STRING]},{name:"ng-repeat",types:[f.types.ARRAY]},{name:"ng-options",types:[f.types.ARRAY]},{name:"ng-show",types:[f.types.BOOLEAN]},{name:"ng-hide",types:[f.types.BOOLEAN]},{name:"ng-if",types:[f.types.BOOLEAN]},{name:"ng-checked",types:[f.types.BOOLEAN]},{name:"ng-disabled",types:[f.types.BOOLEAN]},{name:"ng-change",types:[f.types.FUNCTION]},{name:"ng-click",types:[f.types.FUNCTION]},{name:"ng-dblclick",types:[f.types.FUNCTION]},{name:"ng-focus",types:[f.types.FUNCTION]},{name:"ng-blur",types:[f.types.FUNCTION]},{name:"ng-success",types:[f.types.FUNCTION]},{name:"ng-error",types:[f.types.FUNCTION]},{name:"ng-class",types:[f.types.OBJECT]},{name:"ng-style",types:[f.types.OBJECT]},{name:"ng-controller",types:[f.types.STRING]},{name:"ng-form",types:[f.types.STRING]},{name:"ng-include",types:[f.types.STRING]},{name:"ng-src",types:[f.types.STRING]},{name:"ng-href",types:[f.types.STRING]},{name:"ng-maxlength",types:[f.types.NUMBER]},{name:"ng-minlength",types:[f.types.NUMBER]}],h=[];b.module("ngHaki",["ui.router"]).factory("HakiAnalyzer",["HakiParser","HakiTypeChecker","HakiDefinitionChecker",function(c,i,j){var k=function(b,c){d.isUndefined(c)?console.info(b):console[c](b),a.hakiLogFile.push(b)},l=function(){var a={},l=function(a,d){for(var e=d.find("["+a.name+"]"),f=0;f<e.length;f++){var g=b.element(e[f]),h=g.attr(a.name),l=c.parse(g,a,h);j.isInvalid(g,a,l)?k("--- Found: '"+h+"', for attribute: '"+a.name+"', on html element '"+g+"', is NOT defined."):i.isInvalid(g,a,l)&&k("--- Found: '"+h+"', for attribute: '"+a.name+"', on html element '"+g+"', has WRONG type ("+typeof l+").")}};return a.analyze=function(a,b){var c=f.mode===f.HAKI_MODES.AUTO_ONCE;if(!c||!d.contains(e,a)){c&&e.push(a),k("Haki analyzing state: "+a+"...");for(var i=0;i<g.length;i++){var j=g[i];d.contains(f.ignoreList.attribute,j)||l(j,b)}for(var i=0;i<h.length;i++){var j=h[i];d.contains(f.ignoreList.attribute,j)||l(j,b)}}},a};return l}]).service("HakiParser",["$parse",function(a){this.parse=function(b,c,e){var f,g=e.indexOf("(");-1!==g&&(e=e.slice(0,g));for(var h=b.scope();null!==h;){if(f=a(e)(h),!d.isUndefined(f))return f;h=h.$parent}return f}}]).service("HakiDefinitionChecker",[function(){this.isInvalid=function(a,b,c){return null===c||"null"===c||"undefined"==typeof c}}]).service("HakiTypeChecker",[function(){this.isInvalid=function(a,c,e){var g=f.types.UNKNOWN;return b.isString(e)?g=f.types.STRING:b.isObject(e)?g=f.types.OBJECT:b.isNumber(e)?g=f.types.NUMBER:b.isFunction(e)?g=f.types.FUNCTION:b.isArray(e)?g=f.types.ARRAY:b.isDate(e)?g=f.types.DATE:"boolean"==typeof e&&(g=f.types.BOOLEAN),!d.contains(c.types,g)}}]).run(["$rootScope","$timeout","HakiAnalyzer",function(b,c,e){b.$on("$stateChangeSuccess",function(a,b){f.currentState=b}),b.$on("$viewContentLoaded",function(b){var c=$(document.body).find("[ui-view]");if(!d.isUndefined(f.currentState)){var g=new e;f.mode!==f.HAKI_MODES.MANUEL&&g.analyze(f.currentState.name,c),a.haki.analyzer=g}})}]).config(["$injector","$compileProvider",function(c,d){a.haki.mode=f.HAKI_MODES.AUTO_ONCE,a.haki.ignoreAttribute("type"),a.haki.ignoreAttribute("title");var e=d.directive;d.directive=function(d,g){var i=c.invoke(g);if(i.restrict&&b.isString(i.restrict)&&/[E]/.test(i.restrict)&&i.scope&&b.isObject(i.scope))for(var j in i.scope)if(i.scope.hasOwnProperty(j)){var l,m,k=i.scope[j];l=1===k.length?j:k.slice(1,k.length);var n=k.slice(0,1);m="="===n?[f.types.OBJECT,f.types.ARRAY,f.types.DATE,f.types.FILE]:"@"===n?[f.types.STRING,f.types.NUMBER,f.types.BOOLEAN]:"&"===n?[f.types.FUNCTION]:[f.types.UNKNOWN],h.push({name:l,types:m})}e(d,g)}}])}(window,window.angular);